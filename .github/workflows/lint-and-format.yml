# TEMPLATE_PLACEHOLDER: Customize for your project's linting/formatting tools
#
# Lint and Format Workflow
# ------------------------
# Automatically cleans up code style issues before merging.
# Particularly useful for agent-generated code which may have inconsistent formatting.
#
# Options:
# 1. Auto-fix and commit (default) - Fixes issues and commits changes
# 2. Check only - Fails if issues exist (for stricter workflows)

name: Lint and Format

on:
  pull_request:
    branches: [main, develop]
  push:
    branches: [main, develop]

# Only run one instance per PR/branch
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  lint-and-format:
    runs-on: ubuntu-latest
    
    # Skip if commit message contains [skip lint] or is from the formatter bot
    if: |
      !contains(github.event.head_commit.message, '[skip lint]') &&
      github.actor != 'github-actions[bot]'
    
    permissions:
      contents: write
      pull-requests: write
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          # Need full history for accurate diffs
          fetch-depth: 0
          # Use a token that can push (for auto-fix mode)
          token: ${{ secrets.GITHUB_TOKEN }}

      # =====================================================
      # CUSTOMIZE THIS SECTION FOR YOUR TECH STACK
      # =====================================================

      # Node.js Example (Prettier + ESLint)
      # - name: Setup Node.js
      #   uses: actions/setup-node@v4
      #   with:
      #     node-version: '20'
      #     cache: 'npm'
      #
      # - name: Install dependencies
      #   run: npm ci
      #
      # - name: Run Prettier (auto-fix)
      #   run: npx prettier --write "**/*.{js,jsx,ts,tsx,json,md,css,scss}"
      #
      # - name: Run ESLint (auto-fix)
      #   run: npx eslint --fix "**/*.{js,jsx,ts,tsx}" || true
      #
      # - name: Check for changes
      #   id: check_changes
      #   run: |
      #     if [[ -n $(git status --porcelain) ]]; then
      #       echo "has_changes=true" >> $GITHUB_OUTPUT
      #     else
      #       echo "has_changes=false" >> $GITHUB_OUTPUT
      #     fi
      #
      # - name: Commit formatting fixes
      #   if: steps.check_changes.outputs.has_changes == 'true'
      #   run: |
      #     git config --local user.email "github-actions[bot]@users.noreply.github.com"
      #     git config --local user.name "github-actions[bot]"
      #     git add -A
      #     git commit -m "style: auto-format code [skip lint]"
      #     git push

      # Python Example (Ruff)
      # - name: Setup Python
      #   uses: actions/setup-python@v5
      #   with:
      #     python-version: '3.11'
      #
      # - name: Install Ruff
      #   run: pip install ruff
      #
      # - name: Run Ruff format (auto-fix)
      #   run: ruff format .
      #
      # - name: Run Ruff check (auto-fix)
      #   run: ruff check --fix . || true

      # =====================================================
      # PLACEHOLDER: Remove after customizing
      # =====================================================
      - name: Placeholder check
        run: |
          echo "Lint and format workflow placeholder"
          echo "Customize this workflow for your project's linting tools:"
          echo "  - Node.js: Prettier, ESLint"
          echo "  - Python: Ruff, Black, isort"
          echo "  - Go: gofmt, golangci-lint"
          echo "  - Rust: rustfmt, clippy"

      # =====================================================
      # MARKDOWN LINTING (works for all projects)
      # =====================================================
      - name: Lint Markdown files
        uses: DavidAnson/markdownlint-cli2-action@v16
        with:
          globs: |
            **/*.md
            !node_modules/**
            !.git/**
        continue-on-error: true

  # Optional: Separate job for type checking
  # typecheck:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/checkout@v4
  #     - uses: actions/setup-node@v4
  #       with:
  #         node-version: '20'
  #         cache: 'npm'
  #     - run: npm ci
  #     - run: npm run typecheck
