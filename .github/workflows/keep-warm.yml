# TEMPLATE_PLACEHOLDER: Update BACKEND_URL for your project
#
# Keep Backend Warm
# -----------------
# Prevents free-tier services (Render, Railway, etc.) from suspending
# due to inactivity. Pings the health endpoint every 14 minutes.
#
# Setup:
# 1. Create a repository secret named BACKEND_URL with your backend URL
# 2. Or replace the secret reference with a hardcoded URL (less secure)

name: Keep Backend Warm

on:
  schedule:
    # Every 14 minutes (free Render suspends after 15 min inactivity)
    - cron: '*/14 * * * *'
  workflow_dispatch: # Allow manual trigger

jobs:
  ping:
    runs-on: ubuntu-latest
    
    steps:
      - name: Ping backend health endpoint
        env:
          # Option 1: Use repository secret (recommended)
          BACKEND_URL: ${{ secrets.BACKEND_URL }}
          # Option 2: Hardcode URL (uncomment and modify)
          # BACKEND_URL: https://your-app.onrender.com
        run: |
          if [ -z "$BACKEND_URL" ]; then
            echo "⚠️ BACKEND_URL not set. Set as repository secret or hardcode in workflow."
            echo "Skipping ping - this is expected for template repos."
            exit 0
          fi
          
          HEALTH_URL="${BACKEND_URL}/health"
          echo "Pinging: $HEALTH_URL"
          
          RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" "$HEALTH_URL" --max-time 30 || echo "000")
          
          if [ "$RESPONSE" = "200" ]; then
            echo "✅ Backend is healthy (HTTP $RESPONSE)"
          elif [ "$RESPONSE" = "000" ]; then
            echo "⚠️ Backend unreachable (timeout or network error)"
            exit 1
          else
            echo "⚠️ Backend returned HTTP $RESPONSE"
            # Don't fail on non-200 - service might be starting up
          fi

      - name: Log result
        if: always()
        run: |
          echo "Ping completed at $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
